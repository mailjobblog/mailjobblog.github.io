<!DOCTYPE html>
<html  lang="zh-CN" >
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <title>Mysql 的6种日志类型 | 李斌的技术博客</title>
    <meta name="keywords" content="李斌的技术博客,php,go,java,swoole,linux,mysql,编程,程序员,redis,mongodb,大数据分析,汀风说后端" />
    <meta name="description" content="六种日志简介 慢查询日志 slow query log： 记录所有超过long_query_time时间的SQL语句， 二进制日志 binlog： 记录任何引起数据变化的操作，用于备份和还原。默认存放在数据目录中，在刷新和服务重启时会滚动二进制日志。 错误日志 errorlog： MySQL服务启动和关闭过程中的信息以及其它错误和警告信息。默认在数据目录下。 中继日志 relay log： 从主服">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql 的6种日志类型">
<meta property="og:url" content="https://blog.mailjob.net/posts/3395218937.html">
<meta property="og:site_name" content="李斌的技术博客">
<meta property="og:description" content="六种日志简介 慢查询日志 slow query log： 记录所有超过long_query_time时间的SQL语句， 二进制日志 binlog： 记录任何引起数据变化的操作，用于备份和还原。默认存放在数据目录中，在刷新和服务重启时会滚动二进制日志。 错误日志 errorlog： MySQL服务启动和关闭过程中的信息以及其它错误和警告信息。默认在数据目录下。 中继日志 relay log： 从主服">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.github.mailjob.net/oss.github/20210303121451.png">
<meta property="og:image" content="http://img.github.mailjob.net/oss.github/20210303115734.png">
<meta property="og:image" content="http://img.github.mailjob.net/oss.github/20210303133358.jpeg">
<meta property="og:image" content="http://img.github.mailjob.net/oss.github/20210304134818.png">
<meta property="og:image" content="http://img.github.mailjob.net/oss.github/20210304141010.png">
<meta property="og:image" content="http://img.github.mailjob.net/oss.github/20210304144141.png">
<meta property="article:published_time" content="2021-01-18T15:00:00.000Z">
<meta property="article:modified_time" content="2026-02-28T10:56:06.982Z">
<meta property="article:author" content="汀风">
<meta property="article:tag" content="mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.github.mailjob.net/oss.github/20210303121451.png">

    <link rel="alternate" type="application/atom+xml" href="/atom.xml">
    <link rel="icon" href="https://img.github.mailjob.net/logo/tingfeng.ico" type="image/x-icon">

    
<link rel="stylesheet" href="/css/common.min.css">



    
    
    
    
        <link href="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/css/lightgallery.min.css" rel="stylesheet">
    
    
    
<link rel="stylesheet" href="/css/iconfont.min.css">

    

    
<link rel="stylesheet" href="/css/prism.css">

<meta name="generator" content="Hexo 5.4.2"></head>
    <body>
        <header class="header header-fixture">
    <div class="profile-search-wrap flex sm:block">
        
        
        <div class="profile sm:text-center md:px-1 lg:px-3 sm:pb-4 sm:pt-6">
            <a id="avatar" role="link" href="https://github.com/jefferyjob" class="inline-block lg:w-16 lg:h-16 w-8 h-8 m-2" target="_blank" rel="noopener" rel="noreferrer" >
                <img src="https://img.github.mailjob.net/logo/tingfeng.jpg" class="rounded-full" alt="avatar">
            </a>
            <h2 id="name" class="hidden lg:block">李斌</h2>
            <h3 id="title" class="hidden xl:block">此平台用作学习交流日常分享</h3>
            
            <small id="location" class="hidden lg:block">
                <i class="iconfont icon-map-icon"></i>
                Beijin, China
            </small>
            
        </div>
        
        
<div class="search flex-1 flex lg:inline-block sm:hidden lg:px-4 lg:mt-2 lg:mb-4 lg:w-full">
    <form id="search-form" class="my-auto flex-1 lg:border lg:border-solid lg:border-gray-200">
        <div class="input-group table bg-gray-100 lg:bg-white w-full">
            <input id="search-input" type="text" placeholder="搜索" class="inline-block w-full bg-gray-100 lg:bg-white">
            <span class="table-cell">
                <button name="search tigger button" disabled>
                    <i class="iconfont icon-search m-2"></i>
                </button>
            </span>
        </div>
    </form>
        
<div id="content-json" data-placeholder="搜索" class="invisible hidden">/content.json</div>
<script id="search-teamplate" type="text/html" data-path="/content.json">
    <div>
        <div class="search-header bg-gray-400">
            <input id="actual-search-input" model="keyword" ref="input" class="inline-block w-full h-10 px-2 py-1" placeholder="搜索" type="text">
        </div>
        <div class="search-result bg-gray-200">
            {{#each searchPosts}}
            <a href="/{{ path }}" class="result-item block px-2 pb-3 mb-1 pt-1 hover:bg-indigo-100">
                <i class="iconfont icon-file"></i>
                <h1 class="result-title inline font-medium text-lg">{{ title }}</h1>
                <p class="result-content text-gray-600 text-sm">{{{ text }}}</p>
            </a>
            {{/each}}
        </div>
    </div>
</script>

</div>


        <button name="menu toogle button" id="menu-toggle-btn" class="block sm:hidden p-3" role="button" aria-expanded="false">
            <i class="iconfont icon-hamburger"></i>
        </button>
    </div>
    <nav id="menu-nav" class="hidden sm:flex flex-col">
        
        
            <div class="menu-item menu-home" role="menuitem">
                <a href="/.">
                    <i class="iconfont icon-home" aria-hidden="true"></i>
                    <span class="menu-title">首页</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-archives" role="menuitem">
                <a href="/archives">
                    <i class="iconfont icon-archive" aria-hidden="true"></i>
                    <span class="menu-title">归档</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-categories" role="menuitem">
                <a href="/categories">
                    <i class="iconfont icon-folder" aria-hidden="true"></i>
                    <span class="menu-title">分类</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-tags" role="menuitem">
                <a href="/tags">
                    <i class="iconfont icon-tag" aria-hidden="true"></i>
                    <span class="menu-title">标签</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-links" role="menuitem">
                <a href="/links">
                    <i class="iconfont icon-friend" aria-hidden="true"></i>
                    <span class="menu-title">友链</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-about" role="menuitem">
                <a href="/about">
                    <i class="iconfont icon-cup" aria-hidden="true"></i>
                    <span class="menu-title">关于</span>
                </a>
            </div>
        
        
<div class="social-links flex sm:flex-col lg:hidden mt-5">
    
        <span class="social-item text-center">
            <a target="_blank" rel="noopener" href="https://github.com/jefferyjob">
                <i class="iconfont social-icon icon-github"></i>
                <span class="menu-title hidden lg:inline">menu.github</span>
            </a>
        </span>
    
        <span class="social-item text-center">
            <a target="_blank" rel="noopener" href="https://blog.csdn.net/libinemail">
                <i class="iconfont social-icon icon-csdn"></i>
                <span class="menu-title hidden lg:inline">menu.csdn</span>
            </a>
        </span>
    
        <span class="social-item text-center">
            <a target="_blank" rel="noopener" href="https://juejin.cn/user/782508009723783">
                <i class="iconfont social-icon icon-juejin"></i>
                <span class="menu-title hidden lg:inline">menu.juejin</span>
            </a>
        </span>
    
        <span class="social-item text-center">
            <a href="/atom.xml">
                <i class="iconfont social-icon icon-rss"></i>
                <span class="menu-title hidden lg:inline">menu.rss</span>
            </a>
        </span>
    
</div>


    </nav>
</header>

        <section class="main-section">
            
    <main class="flex-1 px-4 py-14 md:px-5 lg:px-8 lg:py-4 relative min-h-screen">
    

    <article class="content article article-archives article-type-list" itemscope="">
        <header class="article-header">
            
    
        <h1 class="article-title text-lg" itemprop="name">
            Mysql 的6种日志类型
        </h1>
    



            <p class="article-meta mb-3 text-xs">
                <span class="article-date">
    <i class="iconfont icon-calendar-check"></i>
	<a href="/posts/3395218937.html" class="article-date">
	  <time datetime="2021-01-18T15:00:00.000Z" itemprop="datePublished">2021-01-18</time>
	</a>
</span>

                
    <span class="article-category">
    <i class="iconfont icon-folder"></i>
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </span>


                
    <span class="article-tags">
    <i class="iconfont icon-tag"></i>
    <a class="article-tag-none-link" href="/tags/mysql/" rel="tag">mysql</a>
  </span>


                <span class="_partial/post-comment"><i class="icon icon-comment"></i>
                    <a href="/posts/3395218937.html#comments" class="article-comment-link">
                        评论
                    </a>
                </span>
                
    
        <span class="post-wordcount" itemprop="wordCount">字数统计: 6.9k(字)</span>
    
    
        <span class="post-readcount" itemprop="timeRequired">阅读时长: 26(分)</span>
    


            </p>
        </header>
        <div class="marked-body article-body">
            <h2 id="六种日志简介">六种日志简介</h2>
<p><strong>慢查询日志 slow query log</strong>： 记录所有超过long_query_time时间的SQL语句，</p>
<p><strong>二进制日志 binlog</strong>： 记录任何引起数据变化的操作，用于备份和还原。默认存放在数据目录中，在刷新和服务重启时会滚动二进制日志。</p>
<p><strong>错误日志 errorlog</strong>： MySQL服务启动和关闭过程中的信息以及其它错误和警告信息。默认在数据目录下。</p>
<p><strong>中继日志 relay log</strong>： 从主服务器的二进制文件中复制的事件，并保存为二进制文件，格式和二进制日志一样。</p>
<p><strong>普通查询日志 general log</strong>： 用于记录select查询语句的日志。general_log、general_log_file 默认关闭，建议关闭。</p>
<p><strong>事务日志</strong>： 保证事务一致性。<em>重做日志（redo log）redo log在数据准备修改前写入缓存中的redo log中，然后才对缓存中的数据执行修改操作，而且保证在发出事务提交指令时，先向缓存中的redo log写入日志，写入完成后才执行提交动作。</em> <em>回滚日志（undo log）提供回滚和多个行版本控制(MVCC)</em></p>
<hr>
<p><strong>日志小结</strong>：</p>
<ol>
<li>重做日志（redo log）和回滚日志（undo log）与事务操作息息相关，二进制日志（binlog）也与事务操作有一定的关系</li>
<li>undo log和redo log记录物理日志不一样，它是逻辑日志。可以认为当delete一条记录时，undo log中会记录一条对应的insert记录，反之亦然，当update一条记录时，它记录一条对应相反的update记录。</li>
<li>另外，undo log也会产生redo log，因为undo log也要实现持久性保护。</li>
</ol>
<h2 id="日志详解">日志详解</h2>
<h3 id="慢查询日志">慢查询日志</h3>
<p><strong>慢查询日志相关参数</strong>：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># 是否开启慢查询，1开启，0关闭</span>
slow_query_log：1

<span class="token comment"># 5.6及以上版本日志路径。</span>
<span class="token comment"># 可不设置该参数，系统则会默认给一个缺省的文件 host_name-slow.log</span>
<span class="token comment"># slow-query-log-file：</span>

<span class="token comment"># 慢查询阈值，当查询时间多于设定的阈值时，记录日志。</span>
long_query_time ： 5

<span class="token comment"># 未使用索引的查询也被记录到慢查询日志中（可选项）</span>
<span class="token comment"># log_queries_not_using_indexes：。</span>

<span class="token comment"># 日志存储方式</span>
<span class="token comment"># FILE 表示将日志存入文件，默认值是 FILE</span>
<span class="token comment"># TABLE 表示将日志存入数据库，日志会写入到 mysql.slow_log表</span>
<span class="token comment"># 支持同时两种日志存储方式，如：log_output='FILE,TABLE'</span>
log_output：'TABLE'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>参数配置</strong></p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 查看日志类型
mysql&gt; show variables like &#39;%log_output%&#39;;
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| log_output    | TABLE |
+---------------+-------+
1 row in set (0.00 sec)

# 设置日志存入方式
set GLOBAL log_output &#x3D; &#39;TABLE&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>查看慢日志文件</strong></p>
<p>如果慢日志存储为File文件，可以使用 <code>cat -n</code> 查看错误日志。如果慢日志存储为Table表，则使用 <code>select</code> 查看表记录。</p>
<p><img src="http://img.github.mailjob.net/oss.github/20210303121451.png" alt="image-20210303121449778"></p>
<p><img src="http://img.github.mailjob.net/oss.github/20210303115734.png" alt="image-20210303115731816"></p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">update &#96;mp_tt_creative&#96; set &#96;image_md5&#96; &#x3D; &#39;t1&#39;, &#96;updated_at&#96; &#x3D; &#39;1611023918&#39; where (&#96;image_ids&#96; &#x3D; &#39;t2&#39;) and &#96;image_md5&#96; is null;
# Time: 2021-01-19T02:41:59.595904Z
# User@Host: RCMP[RCMP] @  [192.168.6.103]  Id: 79024
# Query_time: 1.456396  Lock_time: 0.000028 Rows_sent: 0  Rows_examined: 3925992
SET timestamp&#x3D;1611024119;
select &#96;image_md5&#96; from &#96;mp_tt_creative&#96; where (&#96;image_ids&#96; &#x3D; &#39;t2&#39;) and &#96;image_md5&#96; is not null limit 1;
&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld, Version: 5.7.11-log (Source distribution). started with:
Tcp port: 3306  Unix socket: &#x2F;tmp&#x2F;mysql.sock
Time                 Id Command    Argument<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>通过对以上错误日志的查看，我们发现此处由于程序员对数据库采用循环操作，导致产生了<code>死锁</code>现象。SQL执行时间是（Query_time）: 1.456396  （默认超时是1s）。锁定时间是（Lock_time）: 0.000028 。发送的行数（Rows_sent）: 0  。检查的行数 （Rows_examined）: 3925992</p>
</blockquote>
<p><strong>小妙招</strong></p>
<p>推荐使用 <code>mysqldumpslow</code> 工具去查看慢日志文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 得到返回记录集最多的10个SQL。</span>
mysqldumpslow <span class="token parameter variable">-s</span> r <span class="token parameter variable">-t</span> <span class="token number">10</span> /database/mysql/mysql06_slow.log

<span class="token comment"># 得到访问次数最多的10个SQL</span>
mysqldumpslow <span class="token parameter variable">-s</span> c <span class="token parameter variable">-t</span> <span class="token number">10</span> /database/mysql/mysql06_slow.log

<span class="token comment"># 得到按照时间排序的前10条里面含有左连接的查询语句。</span>
mysqldumpslow <span class="token parameter variable">-s</span> t <span class="token parameter variable">-t</span> <span class="token number">10</span> <span class="token parameter variable">-g</span> “left join” /database/mysql/mysql06_slow.log

<span class="token comment"># 另外建议在使用这些命令时结合 | 和more 使用 ，否则有可能出现刷屏的情况。</span>
mysqldumpslow <span class="token parameter variable">-s</span> r <span class="token parameter variable">-t</span> <span class="token number">20</span> /mysqldata/mysql/mysql06-slow.log <span class="token operator">|</span> <span class="token function">more</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 <code>pt-query-digest</code> 工具进行分析</p>
<p>mysqldumpslow 是 mysql 安装后就自带的工具，用于分析慢查询日志，但是pt-query-digest却不是mysql自带的，如果想使用 pt-query-digest 进行慢查询日志的分析，则需要自己安装 pt-query-digest。pt-query-digest工具相较于mysqldumpslow功能多一点。</p>
<hr>
<p><strong>小结</strong>：</p>
<ol>
<li>日志记录到系统的专用日志表中，要比记录到文件耗费更多的系统资源，因此对于需要启用慢查询日志，又需要能够获得更高的系统性能，那么建议优先记录到文件。</li>
</ol>
<h3 id="二进制日志">二进制日志</h3>
<p><strong>配置参数</strong></p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># # mysql5.7必须加，否则mysql服务启动报错</span>
<span class="token key attr-name">server-id</span> <span class="token punctuation">=</span> <span class="token value attr-value">1</span>
<span class="token comment"># # 路径及命名，默认在data下</span>
<span class="token key attr-name">log-bin</span> <span class="token punctuation">=</span> <span class="token value attr-value">/data/3306/tmp/binlog/mysql-bin</span> 
<span class="token comment"># 过期时间,二进制文件自动删除的天数,0代表不删除</span>
<span class="token key attr-name">expire_logs_days</span> <span class="token punctuation">=</span> <span class="token value attr-value">10</span>
<span class="token comment"># # 单个日志文件大小</span>
<span class="token key attr-name">max_binlog_size</span> <span class="token punctuation">=</span> <span class="token value attr-value">100M</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>参数查看</strong></p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 查看二进制日志设置
mysql&gt; show variables like &#39;log_bin%&#39;;
+---------------------------------+---------------------------------------+
| Variable_name                   | Value                                 |
+---------------------------------+---------------------------------------+
| log_bin                         | ON                                    |
| log_bin_basename                | &#x2F;data&#x2F;3306&#x2F;tmp&#x2F;binlog&#x2F;mysql-bin       |
| log_bin_index                   | &#x2F;data&#x2F;3306&#x2F;tmp&#x2F;binlog&#x2F;mysql-bin.index |
| log_bin_trust_function_creators | OFF                                   |
| log_bin_use_v1_row_events       | OFF                                   |
+---------------------------------+---------------------------------------+

# 查看当前服务器所有的二进制日志文件
mysql&gt; show binary logs;
+------------------+-----------+
| Log_name         | File_size |
+------------------+-----------+
| mysql-bin.000001 |       732 |
+------------------+-----------+

# 查看当前二进制日志的状态
mysql&gt; show master status;
+------------------+----------+--------------+------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------------+----------+--------------+------------------+-------------------+
| mysql-bin.000001 |      732 |              |                  |                   |
+------------------+----------+--------------+------------------+-------------------+

# 查看 bin log 日志
mysql&gt; show binlog events;   #只查看第一个binlog文件的内容
mysql&gt; show binlog events in &#39;mysql-bin.000002&#39;;#查看指定binlog文件的内容
# \G 代表返回结果旋转90度查看（要不然阅读不方便）
mysql&gt;  show binlog events \G;
*************************** 1. row ***************************
   Log_name: mysql-bin.000006
        Pos: 4
 Event_type: Format_desc
  Server_id: 1
End_log_pos: 123
       Info: Server ver: 5.7.30-log, Binlog ver: 4
*************************** 2. row ***************************
   Log_name: mysql-bin.000006
        Pos: 123
 Event_type: Previous_gtids
  Server_id: 1
End_log_pos: 154
       Info: <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="二进制日志的三种模式">二进制日志的三种模式</h4>
<p>二进制日志三种格式：<code>STATEMENT</code>，<code>ROW</code>，<code>MIXED</code>，由参数 <code>binlog_format</code> 控制</p>
<p><strong>STATEMENT模式（SBR）</strong><br>
每一条会修改数据的sql语句会记录到binlog中。<br>
优点：并不需要记录每一条sql语句和每一行的数据变化，减少了binlog日志量，节约IO，提高性能。<br>
缺点：在某些情况（如非确定函数）下会导致master-slave中的数据不一致 &lt; 如sleep()函数， last_insert_id()，以及user-defined functions(udf)等会出现问题 &gt;</p>
<p><strong>ROW模式（RBR）</strong><br>
不记录每条sql语句的上下文信息，仅需记录哪条数据被修改了，修改成什么样了。而且不会出现某些特定情况下的存储过程、或<code>function</code>、或<code>trigger</code>的调用和触发无法被正确复制的问题。<br>
缺点：会产生大量的日志，尤其是<code>alter table</code>的时候会让日志暴涨。</p>
<p><strong>MIXED模式（MBR）</strong><br>
以上两种模式的混合使用，一般的复制使用<code>STATEMENT</code>模式保存<code>binlog</code>，对于<code>STATEMENT</code>模式无法复制的操作使用<code>ROW</code>模式保存<code>binlog</code>，MySQL会根据执行的SQL语句选择日志保存方式</p>
<h4 id="二进制日志恢复数据库">二进制日志恢复数据库</h4>
<p>如果开启了二进制日志，出现了数据丢失，可以通过二进制日志恢复数据库，语法如下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysqlbinlog <span class="token punctuation">[</span>option<span class="token punctuation">]</span> filename <span class="token operator">|</span> mysql <span class="token parameter variable">-u</span> user <span class="token parameter variable">-p</span> <span class="token function">passwd</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>option  的参数主要有两个 <code>--start-datetime</code>  、 <code>--stop-datetime</code> 和 <code>start-position</code> 、  <code>--stop-position </code><br>
前者指定恢复的时间点，后者指定恢复的位置。原理就是把记录的语句重新执行了一次，如果恢复了两次。会产生重复数据。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysqlbinlog --start-position<span class="token operator">=</span><span class="token string">"291"</span> --stop-position<span class="token operator">=</span><span class="token string">"439"</span> /data/3306/tmp/binlog/mysql-bin.000001 <span class="token operator">|</span> mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>注意</strong>：要找到插入更新的语句所在的时间点或位置。如果恢复的语句包含只有 delete，会报错1032错误。</p>
<h3 id="错误日志">错误日志</h3>
<p><strong>相关配置</strong></p>
<blockquote>
<p>在 MySQL 数据库中，默认开启错误日志功能。一般情况下，错误日志存储在 MySQL 数据库的数据文件夹下，通常名称为 hostname.err。其中，hostname 表示 MySQL 服务器的主机名。</p>
<p>在 MySQL 配置文件中，错误日志所记录的信息可以通过 log-error 和 log-warnings 来定义，其中，log-err 定义是否启用错误日志功能和错误日志的存储位置，log-warnings 定义是否将警告信息也记录到错误日志中。</p>
</blockquote>
<p>将 log_error 选项加入到 MySQL 配置文件的 [mysqld]组中，形式如下：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">[mysqld]
log-error=dir/&#123;filename&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>其中，<code>dir</code> 参数指定错误日志的存储路径；<code>filename</code> 参数指定错误日志的文件名；省略参数时文件名默认为主机名，存放在 <code>Data</code> 目录中。</p>
<p><strong>注意</strong>：错误日志中记录的并非全是错误信息，例如 MySQL 如何启动 InnoDB 的表空间文件、如何初始化自己的存储引擎等，这些也记录在错误日志文件中。</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">#查看当前的错误日志配置，缺省情况下位于数据目录
mysql&gt; show variables like &#39;log_error&#39;;
+---------------+------------------------------+
| Variable_name | Value                        |
+---------------+------------------------------+
| log_error     | &#x2F;home&#x2F;data&#x2F;var&#x2F;ruidao104.err |
+---------------+------------------------------+
1 row in set (0.00 sec)

# MySQL 中，可以使用 mysqladmin 命令来开启新的错误日志
mysqladmin -uroot -p flush-logs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>通过<code>tail</code>查看错误日志，得到信息如下</strong>：</p>
<p>可以看到，获取的包已超过最大限制值，连接被中断</p>
<pre class="line-numbers language-none"><code class="language-none">[root@ruidao104 var]# tail -3 ruidao104.err 
2021-03-03T02:37:16.012565Z 417174 [Note] Aborted connection 417174 to db: &#39;RCMP&#39; user: &#39;RCMP&#39; host: &#39;192.168.6.103&#39; (Got a packet bigger than &#39;max_allowed_packet&#39; bytes)
2021-03-03T03:45:45.595497Z 417172 [Note] Aborted connection 417172 to db: &#39;RCMP&#39; user: &#39;RCMP&#39; host: &#39;192.168.6.103&#39; (Got a packet bigger than &#39;max_allowed_packet&#39; bytes)
2021-03-03T04:20:15.629779Z 418987 [Note] Aborted connection 418987 to db: &#39;RCMP&#39; user: &#39;RCMP&#39; host: &#39;192.168.6.103&#39; (Got a packet bigger than &#39;max_allowed_packet&#39; bytes)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="中继日志">中继日志</h3>
<p><strong>什么是中继日志？？？</strong></p>
<p>从服务器 I/O 线程将主服务器的二进制日志读取过来记录到从服务器本地文件，然后从服务器 SQL 线程会读取 relay-log 日志的内容并应用到从服务器，从而使从服务器和主服务器的数据保持一致</p>
<p><strong>相关配置</strong>：</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 查看中继日志配置信息
mysql&gt; show variables like &#39;%relay%&#39;;
+---------------------------+---------------------------------------------+
| Variable_name             | Value                                       |
+---------------------------+---------------------------------------------+
| max_relay_log_size        | 0                                           |
| relay_log                 |                                             |
| relay_log_basename        | &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;c467506ed598-relay-bin       |
| relay_log_index           | &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;c467506ed598-relay-bin.index |
| relay_log_info_file       | relay-log.info                              |
| relay_log_info_repository | FILE                                        |
| relay_log_purge           | ON                                          |
| relay_log_recovery        | OFF                                         |
| relay_log_space_limit     | 0                                           |
| sync_relay_log            | 10000                                       |
| sync_relay_log_info       | 10000                                       |
+---------------------------+---------------------------------------------+
11 rows in set (0.79 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>max_relay_log_size</strong>： relay log 允许的最大值，如果该值为0，则默认值为 max_binlog_size (<code>1G</code>)</p>
<p><strong>relay_log</strong>： 定义 relay_log 的位置和名称，如果值为空，则默认位置在数据文件的目录；</p>
<p><strong>relay_log_index</strong>：  定义 relay_log 索引的位置和名称，记录有几个 relay_log 文件，默认为2个</p>
<p><strong>relay_log_info_file</strong>： 定义 <a target="_blank" rel="noopener" href="http://relay-log.info">relay-log.info</a> 的位置和名称。<a target="_blank" rel="noopener" href="http://relay-log.info">relay-log.info</a> 记录 master 主库的 binary_log 的恢复位置和 从库 relay_log 的位置；</p>
<p><strong>relay_log_recovery</strong>：  当<code>slave从库</code>宕机后，假如<code>relay-log</code>损坏了，导致一部分中继日志没有处理，则自动放弃所有未执行的<code>relay-log</code>，并且重新从master上获取日志，这样就保证了<code>relay-log</code>的完整性。默认情况下该功能是关闭的，将<code>relay_log_recovery</code>的值设置为 1时，可在slave从库上开启该功能，建议开启。</p>
<p><strong>relay_log_space_limit</strong>：  防止中继日志写满磁盘，这里设置中继日志最大限额。但此设置存在主库崩溃，从库中继日志不全的情况，不到万不得已<code>不推荐使用</code></p>
<p><strong>relay_log_purge</strong>： 是否自动清空中继日志，默认值为1(启用)；</p>
<p>**sync_relay_log： **当设置为1时，slave的I/O线程每次接收到master发送过来的binlog日志都要写入系统缓冲区，然后刷入relay log中继日志里，这样是最安全的，因为在崩溃的时候，你最多会丢失一个事务，但会造成磁盘的大量I/O。当设置为0时，并不是马上就刷入中继日志里，而是由操作系统决定何时来写入，虽然安全性降低了，但减少了大量的磁盘I/O操作。这个值默认是0，可动态修改。</p>
<p><strong>sync_relay_log_info</strong>： 这个参数和 sync_relay_log 参数一样。</p>
<h4 id="mysql主从原理图">mysql主从原理图</h4>
<p><img src="http://img.github.mailjob.net/oss.github/20210303133358.jpeg" alt="105353509.jpg"></p>
<p><strong>主从简单说明</strong>：  从上图中，可以看出。mysql主服务器执行了一个  update  操作后，从库生成了两个线程，一个IO线程，一个SQL线程 。主库将  binlog发送给 从库 I/O 线程，从库 I/O 线程将 binlog 写入 relay log（中继日志）。从库的 SQL 线程，会读取 relay log 文件中的日志，并解析成具体操作执行，实现主从最终数据一致；</p>
<hr>
<p><strong>小结</strong>：</p>
<ol>
<li>中继日志生效于mysql主从复制过程中的从服务器上。</li>
<li>它的任务就是，解析 binlog 日志，判断偏移量，根据偏移量对数据库做出DDL的操作，最终实现mysql的主从一致。</li>
</ol>
<h3 id="普通查询日志">普通查询日志</h3>
<p>开启 general log 将所有到达MySQL Server的SQL语句记录下来。</p>
<p>一般不会开启开功能，因为log的量会非常庞大。但个别情况下可能会临时的开一会儿general log以供排障使用。<br>
相关参数一共有3：general_log、log_output、general_log_file</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">show variables like &#39;general_log&#39;; -- 查看日志是否开启
set global general_log&#x3D;on; -- 开启日志功能
show variables like &#39;general_log_file&#39;; -- 看看日志文件保存位置
set global general_log_file&#x3D;&#39;tmp&#x2F;general.lg&#39;; -- 设置日志文件保存位置
show variables like &#39;log_output&#39;; -- 看看日志输出类型 table或file
set global log_output&#x3D;&#39;table&#39;; -- 设置输出类型为 table
set global log_output&#x3D;&#39;file&#39;; -- 设置输出类型为file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="事务日志">事务日志</h3>
<p><strong>初步认识事务日志</strong></p>
<p>InnoDB 事务日志一共分为两个，重做日志，回滚日志。redo log是重做日志，提供前滚操作。undo log是回滚日志，提供回滚操作。</p>
<p>undo log不是redo log的逆向过程，其实它们都算是用来恢复的日志：</p>
<ol>
<li>redo log通常是物理日志，记录的是数据页的物理修改，而不是某一行或某几行修改成怎样怎样，它用来恢复提交后的物理数据页(恢复数据页，且只能恢复到最后一次提交的位置)。</li>
<li>undo log 用来回滚行记录到某个版本。undo log一般是<code>逻辑日志</code>，根据每行记录进行记录（为了更好的理解 undo log 请学习一下mysql 的 MVCC）。</li>
</ol>
<p><strong>案例分析两个日志的区别</strong></p>
<p>通过  update  伪代码进行演示</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 初始内容
id &#x3D; 1
name &#x3D; 阿里巴巴

# 执行语句，把阿里巴巴修改成百度
UPDATE user SET name &#x3D; &#39;百度&#39; WHERE id &#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>undo 回滚日志记录信息如下：</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">UPDATE user SET name &#x3D; &#39;阿里巴巴&#39; WHERE id &#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>redo log 重做日志File记录信息如下：</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">UPDATE user SET name &#x3D; &#39;百度&#39; WHERE id &#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>另外，undo log也会产生redo log，因为undo log也要实现持久性保护</p>
<h4 id="REDO-LOG详解">REDO LOG详解</h4>
<blockquote>
<p>为了更好的理解 redo log 请先学习：Mysql checkpoint 和 Linux fsync。checkpoint：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lintong/p/4381578.html">https://www.cnblogs.com/lintong/p/4381578.html</a></p>
</blockquote>
<p><strong>REDO LOG 和 BIN LOG的区别</strong>：</p>
<ol>
<li>redo log是属于innoDB层面，binlog属于MySQL Server层面的，这样在数据库用别的存储引擎时可以达到一致性的要求。</li>
<li>redo log是物理日志，记录该数据页更新的内容；binlog是逻辑日志，记录的是这个更新语句的原始逻辑</li>
<li>redo log是循环写，日志空间大小固定；binlog是追加写，是指一份写到一定大小的时候会更换下一个文件，不会覆盖。</li>
<li>binlog可以作为恢复数据使用，主从复制搭建，redo log作为异常宕机或者介质故障后的数据恢复使用。</li>
</ol>
<p><strong>REDO LOG 基本概念</strong>：</p>
<p>redo log 包括两部分：一是内存中的日志缓冲(redo log buffer)，该部分日志是易失性的；二是磁盘上的重做日志文件(redo log file)，该部分日志是持久的</p>
<p>为了确保每次日志都能写入到事务日志文件中，在每次将log buffer中的日志写入日志文件的过程中都会调用一次操作系统的fsync操作(即fsync()系统调用)。</p>
<p>也就是说，从redo log buffer写日志到磁盘的redo log file中，过程如下（<em>关系写入规则，可阅读 &lt; mysql的 IO 流程 &gt;</em>）：</p>
<p><img src="http://img.github.mailjob.net/oss.github/20210304134818.png" alt="img"></p>
<p><strong>REDO LOG的日志块(log block)</strong></p>
<p>innodb存储引擎中，redo log以块为单位进行存储的，每个块占 512字节(byte)，这称为 redo log block。所以不管是 log buffer 中还是 os buffer 中以及 redo log file on disk 中，都是这样以512字节的块存储的。</p>
<p>每个redo log block由3部分组成**：日志块头、日志块尾和日志主体**。其中日志块<code>头占用12字节</code>，日志块尾占用<code>8字节</code>，所以每个redo log block的日志主体部分只有512-12-8=<code>492字节</code>。</p>
<p><img src="http://img.github.mailjob.net/oss.github/20210304141010.png" alt="img"></p>
<h4 id="InnoDB事务恢复行为">InnoDB事务恢复行为</h4>
<p>在启动innodb的时候，不管上次是正常关闭还是异常关闭，总是会进行恢复操作。</p>
<p>因为redo log记录的是数据页的物理变化，因此恢复的时候速度比逻辑日志(如二进制日志)要快很多。而且，innodb自身也做了一定程度的优化，让恢复速度变得更快。</p>
<p>重启innodb时，checkpoint表示已经完整刷到磁盘上data page上的LSN，因此恢复时仅需要恢复从checkpoint开始的日志部分。例如，当数据库在上一次checkpoint的LSN为10000时宕机，且事务是已经提交过的状态。启动数据库时会检查磁盘中数据页的LSN，如果数据页的LSN小于日志中的LSN，则会从检查点开始恢复。</p>
<p>还有一种情况，在宕机前正处于checkpoint的刷盘过程，且数据页的刷盘进度超过了日志页的刷盘进度。这时候一宕机，数据页中记录的LSN就会大于日志页中的LSN，在重启的恢复过程中会检查到这一情况，这时超出日志进度的部分将不会重做，因为这本身就表示已经做过的事情，无需再重做。</p>
<p>另外，事务日志具有幂等性，所以多次操作得到同一结果的行为在日志中只记录一次。而二进制日志不具有幂等性，多次操作会全部记录下来，在恢复的时候会多次执行二进制日志中的记录，速度就慢得多。例如，某记录中id初始值为2，通过update将值设置为了3，后来又设置成了2，在事务日志中记录的将是无变化的页，根本无需恢复；而二进制会记录下两次update操作，恢复时也将执行这两次update操作，速度比事务日志恢复更慢。</p>
<h4 id="UNDO-LOG详解">UNDO LOG详解</h4>
<blockquote>
<p>为了更好的理解 undo log 请先学习：隔离机制，事务，mvcc。</p>
<p>隔离机制：<a href="https://blog.mailjob.net/posts/607672036.html%E3%80%82%E4%BA%8B%E5%8A%A1%EF%BC%9Ahttps://blog.mailjob.net/posts/3043506726.html%E3%80%82MVCC%EF%BC%9Ahttps://blog.mailjob.net/posts/1291031357.html%E3%80%82https://blog.mailjob.net/posts/2327774433.html">https://blog.mailjob.net/posts/607672036.html。事务：https://blog.mailjob.net/posts/3043506726.html。MVCC：https://blog.mailjob.net/posts/1291031357.html。https://blog.mailjob.net/posts/2327774433.html</a></p>
</blockquote>
<p><strong>基本概念</strong>：</p>
<p>undo log有两个作用：提供回滚和多个行版本控制(MVCC)。</p>
<p>在数据修改的时候，不仅记录了redo，还记录了相对应的undo，如果因为某些原因导致事务失败或回滚了，可以借助该undo进行回滚。</p>
<p>undo log和redo log记录物理日志不一样，它是逻辑日志。可以认为当delete一条记录时，undo log中会记录一条对应的insert记录，反之亦然，当update一条记录时，它记录一条对应相反的update记录。</p>
<p>当执行<code>rollback</code>时，就可以从 undo log 中的逻辑记录读取到相应的内容并进行回滚。</p>
<p>有时候应用到行版本控制的时候，也是通过 undo log 来实现的：当读取的某一行被其他事务锁定时，它可以从undo log 中分析出该行记录以前的数据是什么，从而提供该行版本信息，让用户实现非锁定一致性读取。</p>
<p>另外，undo log 也会产生 redo log，因为 undo log 也要实现持久性保护。</p>
<p><strong>UNDO LOG存储方式</strong></p>
<p>innodb存储引擎对undo的管理采用段的方式。<strong>rollback segment</strong>称为回滚段，每个回滚段中有1024个undo log segment。</p>
<p>在以前老版本，只支持1个rollback segment，这样就只能记录1024个undo log segment。后来MySQL5.5可以支持128个rollback segment，即支持128*1024个undo操作，还可以通过变量 innodb_undo_logs (5.6版本以前该变量是 innodb_rollback_segments )自定义多少个rollback segment，默认值为128。</p>
<p>undo log默认存放在共享表空间中。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@xuexi data<span class="token punctuation">]</span><span class="token comment"># ll /mydata/data/ib*</span>
-rw-rw---- <span class="token number">1</span> mysql mysql <span class="token number">79691776</span> Mar <span class="token number">31</span> 01:42 /mydata/data/ibdata1
-rw-rw---- <span class="token number">1</span> mysql mysql <span class="token number">50331648</span> Mar <span class="token number">31</span> 01:42 /mydata/data/ib_logfile0
-rw-rw---- <span class="token number">1</span> mysql mysql <span class="token number">50331648</span> Mar <span class="token number">31</span> 01:42 /mydata/data/ib_logfile1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果开启了 innodb_file_per_table ，将放在每个表的.ibd文件中。</p>
<p>在MySQL5.6中，undo的存放位置还可以通过变量 innodb_undo_directory 来自定义存放目录，默认值为&quot;.&quot;表示datadir。</p>
<p>默认rollback segment全部写在一个文件中，但可以通过设置变量 innodb_undo_tablespaces 平均分配到多少个文件中。该变量默认值为0，即全部写入一个表空间文件。该变量为静态变量，只能在数据库示例停止状态下修改，如写入配置文件或启动时带上对应参数。但是innodb存储引擎在启动过程中提示，不建议修改为非0的值，如下：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">2017-03-31 13:16:00 7f665bfab720 InnoDB: Expected to open 3 undo tablespaces but was able
2017-03-31 13:16:00 7f665bfab720 InnoDB: to find only 0 undo tablespaces.
2017-03-31 13:16:00 7f665bfab720 InnoDB: Set the innodb_undo_tablespaces parameter to the
2017-03-31 13:16:00 7f665bfab720 InnoDB: correct value and retry. Suggested value is 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="DELETE-UPDATE操作的内部机制">DELETE/UPDATE操作的内部机制</h4>
<p>当事务提交的时候，innodb 不会立即删除undo log，因为后续还可能会用到 undo log，如隔离级别为<code>RR</code>时，事务读取的都是开启事务时的最新提交行版本，只要该事务不结束，该行版本就不能删除，即 undo log 不能删除。</p>
<p>但是在事务提交的时候，会将该事务对应的 undo log 放入到删除列表中，未来通过<code>purge</code>来删除。并且提交事务时，还会判断 undo log 分配的页是否可以重用，如果可以重用，则会分配给后面来的事务，避免为每个独立的事务分配独立的undo log页而浪费存储空间和性能。</p>
<p>通过undo log记录delete和update操作的结果发现：(insert操作无需分析，就是插入行而已)</p>
<ul>
<li>delete操作实际上不会直接删除，而是将delete对象打上delete flag，标记为删除，最终的删除操作是purge线程完成的。</li>
<li>update分为两种情况：update的列是否是主键列。
<ul>
<li>如果不是主键列，在undo log中直接反向记录是如何update的。即update是直接进行的。</li>
<li>如果是主键列，update分两部执行：先删除该行，再插入一行目标行。</li>
</ul>
</li>
</ul>
<h2 id="总结">总结</h2>
<h3 id="BinLog和事务日志的先后顺序及group-commit">BinLog和事务日志的先后顺序及group commit</h3>
<p>为了提高性能，通常会将有关联性的多个数据修改操作放在一个事务中，这样可以避免对每个修改操作都执行完整的持久化操作。这种方式，可以看作是人为的组提交(group commit)。</p>
<p>除了将多个操作组合在一个事务中，记录binlog的操作也可以按组的思想进行优化：将多个事务涉及到的binlog一次性flush，而不是每次flush一个binlog。</p>
<p>事务在提交的时候不仅会记录事务日志，还会记录二进制日志，但是它们谁先记录呢？二进制日志是MySQL的上层日志，先于存储引擎的事务日志被写入。</p>
<blockquote>
<p>在<code>MySQL5.6</code>以前，当事务提交(即发出commit指令)后，MySQL接收到该信号进入commit prepare阶段；进入prepare阶段后，立即写内存中的二进制日志，写完内存中的二进制日志后就相当于确定了commit操作；然后开始写内存中的事务日志；最后将二进制日志和事务日志刷盘，它们如何刷盘，分别由变量sync_binlog 和 innodb_flush_log_at_trx_commit 控制。</p>
</blockquote>
<p>但因为要保证二进制日志和事务日志的一致性，在提交后的prepare阶段会启用一个<strong>prepare_commit_mutex</strong>锁来保证它们的顺序性和一致性。但这样会导致开启二进制日志后group commmit失效，特别是在主从复制结构中，几乎都会开启二进制日志。</p>
<p>在MySQL5.6中进行了改进。提交事务时，在存储引擎层的上一层结构中会将事务按序放入一个队列，队列中的第一个事务称为leader，其他事务称为follower，leader控制着follower的行为。虽然顺序还是一样先刷二进制，再刷事务日志，但是机制完全改变了：删除了原来的prepare_commit_mutex行为，也能保证即使开启了二进制日志，group commit也是有效的。</p>
<p>MySQL5.6中分为3个步骤**：flush阶段、sync阶段、commit阶段。**</p>
<p><img src="http://img.github.mailjob.net/oss.github/20210304144141.png" alt="img"></p>
<ul>
<li><strong>flush阶段</strong>： 向内存中写入每个事务的二进制日志。</li>
<li><strong>sync阶段</strong>： 将内存中的二进制日志刷盘。若队列中有多个事务，那么仅一次fsync操作就完成了二进制日志的刷盘操作。这在MySQL5.6中称为BLGC(binary log group commit)。</li>
<li><strong>commit阶段</strong>： leader根据顺序调用存储引擎层事务的提交，由于innodb本就支持group commit，所以解决了因为锁 prepare_commit_mutex 而导致的group commit失效问题。</li>
</ul>
<p>在flush阶段写入二进制日志到内存中，但是不是写完就进入sync阶段的，而是要等待一定的时间，多积累几个事务的binlog一起进入sync阶段，等待时间由变量 binlog_max_flush_queue_time 决定，默认值为0表示不等待直接进入sync，设置该变量为一个大于0的值的好处是group中的事务多了，性能会好一些，但是这样会导致事务的响应时间变慢，所以建议不要修改该变量的值，除非事务量非常多并且不断的在写入和更新。</p>
<p>进入到sync阶段，会将binlog从内存中刷入到磁盘，刷入的数量和单独的二进制日志刷盘一样，由变量 sync_binlog 控制。</p>
<p>当有一组事务在进行commit阶段时，其他新事务可以进行flush阶段，它们本就不会相互阻塞，所以group commit会不断生效。当然，group commit的性能和队列中的事务数量有关，如果每次队列中只有1个事务，那么group commit和单独的commit没什么区别，当队列中事务越来越多时，即提交事务越多越快时，group commit的效果越明显。</p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li>
<p>binlog日志：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/f-ck-need-u/p/9001061.html#blog5">https://www.cnblogs.com/f-ck-need-u/p/9001061.html#blog5</a></p>
</li>
<li>
<p>事务日志：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html">https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html</a></p>
</li>
<li>
<p>mysql的IO流程：<a href="https://blog.mailjob.net/posts/694055385.html">https://blog.mailjob.net/posts/694055385.html</a></p>
</li>
</ul>

        </div>
        
<blockquote class="copyright">
    <p><strong>本文链接 : </strong><a class="permalink" href="https://blog.mailjob.net/posts/3395218937.html">https://blog.mailjob.net/posts/3395218937.html</a></p>
    <p><strong>This article is available under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</a> License</strong></p>
</blockquote>


    </article>
    
    <section id="comments">
        
    </section>


    

</main>


<aside style="" id="sidebar" class="aside aside-fixture">
    <div class="toc-sidebar">
        <nav id="toc" class="article-toc">
            <h3 class="toc-title">文章目录</h3>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E7%A7%8D%E6%97%A5%E5%BF%97%E7%AE%80%E4%BB%8B"><span class="toc-text">六种日志简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AF%A6%E8%A7%A3"><span class="toc-text">日志详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">慢查询日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="toc-text">二进制日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E7%9A%84%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-text">二进制日志的三种模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">二进制日志恢复数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-text">错误日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E7%BB%A7%E6%97%A5%E5%BF%97"><span class="toc-text">中继日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql%E4%B8%BB%E4%BB%8E%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-text">mysql主从原理图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">普通查询日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97"><span class="toc-text">事务日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#REDO-LOG%E8%AF%A6%E8%A7%A3"><span class="toc-text">REDO LOG详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#InnoDB%E4%BA%8B%E5%8A%A1%E6%81%A2%E5%A4%8D%E8%A1%8C%E4%B8%BA"><span class="toc-text">InnoDB事务恢复行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UNDO-LOG%E8%AF%A6%E8%A7%A3"><span class="toc-text">UNDO LOG详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DELETE-UPDATE%E6%93%8D%E4%BD%9C%E7%9A%84%E5%86%85%E9%83%A8%E6%9C%BA%E5%88%B6"><span class="toc-text">DELETE&#x2F;UPDATE操作的内部机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BinLog%E5%92%8C%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97%E7%9A%84%E5%85%88%E5%90%8E%E9%A1%BA%E5%BA%8F%E5%8F%8Agroup-commit"><span class="toc-text">BinLog和事务日志的先后顺序及group commit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">参考资料</span></a></li></ol>
        </nav>
    </div>
</aside>





        </section>
        <footer class="hidden lg:block fixed bottom-0 left-0 sm:w-1/12 lg:w-1/6 bg-gray-100 z-40">
    
    <div class="footer-social-links">
        
            <a target="_blank" rel="noopener" href="https://github.com/jefferyjob">
                <i class="iconfont icon-github"></i>
            </a>
        
            <a target="_blank" rel="noopener" href="https://blog.csdn.net/libinemail">
                <i class="iconfont icon-csdn"></i>
            </a>
        
            <a target="_blank" rel="noopener" href="https://juejin.cn/user/782508009723783">
                <i class="iconfont icon-juejin"></i>
            </a>
        
            <a href="/atom.xml">
                <i class="iconfont icon-rss"></i>
            </a>
        
    </div>
    
    
        <p class="footer-custom">京ICP备17056825号</p>
        <p class="theme-brand">Copyright by <a href="//blog.mailjob.net" rel="nofollow noopener noreferrer">mailjob.net</a></p>
    

    <script src="/js/prism.js" async></script>
</footer>
        <div id="mask" class="hidden mask fixed inset-0 bg-gray-900 opacity-75 z-40"></div>
        <div id="search-view-container" class="hidden shadow-xl"></div>
        
<script src="/js/dom-event.min.js"></script>



<script src="/js/local-search.min.js"></script>



    <script src="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/js/lightgallery.min.js"></script>
    
<script src="/js/light-gallery.min.js"></script>






    </body>
</html>
<!-- 百度站长推送 -->
<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https'){
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else{
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

<!--友盟统计-->
<span style="display: none;">
    <script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1279692087&web_id=1279692087"></script>
</span>
